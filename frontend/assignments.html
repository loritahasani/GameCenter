<!DOCTYPE html>
<html lang="sq">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detyrat e Mia - Game Center</title>
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
    <div class="assignments-container">
        <div class="assignments-header">
            <h1>Detyrat e Mia</h1>
            <a href="index.html" class="back-to-games-btn">Kthehu te Lojërat</a>
        </div>
        <div id="assignments-list">
            <p>Duke ngarkuar detyrat...</p>
        </div>
    </div>

    <script src="assets/js/auth.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const token = localStorage.getItem('token');
            const selectedClass = localStorage.getItem('selectedClass');

            if (!token) {
                window.location.href = 'index.html';
                return;
            }
            if (!selectedClass) {
                alert("Ju lutem zgjidhni një klasë fillimisht.");
                window.location.href = 'index.html';
                return;
            }

            fetch(`/api/my-assignments?class=${selectedClass}`, {
                headers: { 'Authorization': `Bearer ${token}` }
            })
            .then(res => res.json())
            .then(assignments => {
                const container = document.getElementById('assignments-list');
                if (assignments.error) {
                    container.innerHTML = `<p style="color:red;">${assignments.error}</p>`;
                    return;
                }
                if (assignments.length === 0) {
                    container.innerHTML = '<p>Nuk ka detyra për momentin.</p>';
                    return;
                }
                container.innerHTML = '';
                assignments.forEach(assignment => {
                    const assignmentCard = `
                        <div class="assignment-card">
                            <h3>${assignment.title}</h3>
                            <p>${assignment.description}</p>
                            <small>Postuar më: ${new Date(assignment.created_at.$date).toLocaleDateString()}</small>
                            <div class="submission-area">
                                <h4>Dorëzo Detyrën:</h4>
                                <textarea id="submission-text-${assignment._id}" placeholder="Shkruaj përgjigjen tënde..."></textarea>
                                <input type="file" id="submission-file-${assignment._id}">
                                <button onclick="submitAssignment('${assignment._id}')">Dorëzo</button>
                            </div>
                        </div>
                    `;
                    container.innerHTML += assignmentCard;
                });
            })
            .catch(err => {
                console.error('Failed to load assignments:', err);
                document.getElementById('assignments-list').innerHTML = '<p style="color:red;">Gabim në ngarkimin e detyrave.</p>';
            });
        });

        function submitAssignment(assignmentId) {
            alert(`Dorëzimi për detyrën ${assignmentId} nuk është implementuar ende.`);
            // Logic for submission will be added in the next step
        }
    </script>
</body>
</html> 