<!DOCTYPE html>
<html lang="sq">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Center - Hyrje dhe Regjistrim</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <!-- LOGIN SECTION -->
    <section id="login-section">
        <h2>Hyr në llogarinë tënde</h2>
        <form id="login-form">
            <label for="login-email">Email:</label>
            <input type="email" id="login-email" required>

            <label for="login-password">Fjalëkalimi:</label>
            <input type="password" id="login-password" required minlength="6">

            <button type="submit">Hyr</button>
        </form>
        <p>Nuk ke një llogari? <a href="#" id="show-signup">Regjistrohu</a></p>
    </section>

    <!-- SIGNUP SECTION -->
    <section id="signup-section" style="display:none;">
        <h2>Krijo një llogari</h2>
        <form id="signup-form">
            <label for="signup-name">Emri:</label>
            <input type="text" id="signup-name" required>
            
            <label for="signup-email">Email:</label>
            <input type="email" id="signup-email" required>
            
            <label for="signup-password">Fjalëkalimi:</label>
            <input type="password" id="signup-password" required minlength="6">

            <label for="confirm-password">Konfirmo Fjalëkalimin:</label>
            <input type="password" id="confirm-password" required minlength="6">

            <label>Zgjedh rolin:</label>
            <div class="role-selection">
                <input type="radio" id="student" name="role" value="student" checked>
                <label for="student">Student</label>

                <input type="radio" id="teacher" name="role" value="teacher">
                <label for="teacher">Mësues</label>
            </div>

            <div id="student-fields">
                <label for="school">Shkolla:</label>
                <select id="school" name="school" required>
                    <option value="" selected disabled>Zgjedh shkollën</option>
                    <option value="shkollaA">Shkolla A</option>
                    <option value="shkollaB">Shkolla B</option>
                </select>

                <label for="teacher">Mësuesi:</label>
                <select id="teacher" name="teacher" required>
                    <option value="" selected disabled>Zgjedh mësuesin</option>
                    <option value="MesuesiA">Mesuesi A</option>
                    <option value="MesuesiB">Mesuesi B</option>
                </select>
            </div>

            <button type="submit">Regjistrohu</button>
        </form>
        <p>Ke tashmë një llogari? <a href="#" id="show-login">Hyr</a></p>
    </section>

<script>
    // Kalo mes login/signup
    document.getElementById("show-signup").addEventListener("click", function() {
        document.getElementById("login-section").style.display = "none";
        document.getElementById("signup-section").style.display = "block";
    });

    document.getElementById("show-login").addEventListener("click", function() {
        document.getElementById("signup-section").style.display = "none";
        document.getElementById("login-section").style.display = "block";
    });

    // Role switching
    document.querySelectorAll('input[name="role"]').forEach((radio) => {
        radio.addEventListener("change", function() {
            let studentFields = document.getElementById("student-fields");
            if (this.value === "student") {
                studentFields.style.display = "block";
            } else {
                studentFields.style.display = "none";
            }
        });
    });

    // Mesuesit sipas shkollave
    const teachersBySchool = {
        "shkollaA": ["Mësuesi A1", "Mësuesi A2", "Mësuesi A3"],
        "shkollaB": ["Mësuesi B1", "Mësuesi B2"]
    };

    document.getElementById("school").addEventListener("change", function() {
        let school = this.value;
        let teacherSelect = document.getElementById("teacher");
        teacherSelect.innerHTML = '<option value="" selected disabled>Zgjedh mësuesin</option>';
        if (teachersBySchool[school]) {
            teachersBySchool[school].forEach(function(teacher) {
                let option = document.createElement("option");
                option.value = teacher;
                option.textContent = teacher;
                teacherSelect.appendChild(option);
            });
        }
    });

    // REGJISTRIM
    document.getElementById("signup-form").addEventListener("submit", async function(event) {
        event.preventDefault();

        let name = document.getElementById("signup-name").value;
        let email = document.getElementById("signup-email").value;
        let password = document.getElementById("signup-password").value;
        let confirmPassword = document.getElementById("confirm-password").value;
        let role = document.querySelector('input[name="role"]:checked').value;
        let school = document.getElementById("school").value || "";

        if (password !== confirmPassword) {
            alert("Fjalëkalimet nuk përputhen!");
            return;
        }

        try {
            const response = await fetch("http://localhost:5000/register", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ name, email, password, role, school })
            });

            const result = await response.json();

            if (response.ok) {
                alert(result.message);
                document.getElementById("signup-form").reset();
                document.getElementById("signup-section").style.display = "none";
                document.getElementById("login-section").style.display = "block";
            } else {
                alert(result.error);
            }
        } catch (error) {
            alert("Gabim gjatë regjistrimit!");
            console.error(error);
        }
    });

    // LOGIN
   // LOGIN
document.getElementById("login-form").addEventListener("submit", async function(event) {
    event.preventDefault();

    const email = document.getElementById("login-email").value;
    const password = document.getElementById("login-password").value;

    try {
        const response = await fetch("http://127.0.0.1:5000/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email, password })
        });

        const result = await response.json();

        if (response.ok) {
            alert(result.message);
            localStorage.setItem("token", result.token);

            // Kontrollo rolin dhe drejto në faqen përkatëse
            if (result.role === "student") {
                window.location.href = "dashboard.html";  // Përdoruesi është student
            } else if (result.role === "teacher") {
                window.location.href = "teacher-results.html";  // Përdoruesi është mësues
            }
        } else {
            alert(result.error);
        }
    } catch (error) {
        alert("Gabim gjatë kyçjes!");
        console.error(error);
    }
});

</script>

</body>
</html>
